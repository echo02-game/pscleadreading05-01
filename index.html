<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™®é€šè©±æ°´å¹³æ¸¬è©¦æœ—è®€ä½œå“5è™Ÿ</title>
    <style>
        /* --- 1. åŸºç¤æ¨£å¼èˆ‡å­—é«” --- */
        @font-face {
            font-family: 'StandardPinyin';
            src: local('Calibri'), local('Arial');
        }
        
        :root {
            --primary-color: #4a90e2;
            --text-color: #333;
            --pinyin-color: #666;
            --star-inactive: #e0e0e0;
            --star-active: #ffd700;
            --bg-color: #f9f9f9;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            /* å­—é«”æ£§ï¼šMacä½¿ç”¨åœ“é«”ï¼ŒWindowsä½¿ç”¨å¹¼åœ“ï¼Œå¾Œå‚™å¾®è»Ÿé›…é»‘ */
            font-family: "Yuanti SC", "YouYuan", "Microsoft YaHei", "Rounded Mplus 1c", sans-serif;
            -webkit-font-smoothing: antialiased;
            padding-bottom: 200px; /* åº•éƒ¨ç•™ç™½ï¼Œé˜²æ­¢è¢«çå‹µæ¬„é®æ“‹ */
            color: var(--text-color);
        }

        /* --- 2. é ‚éƒ¨æ¨™é¡Œæ¬„ --- */
        .header {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            background: rgba(255,255,255,0.98);
            padding: 10px 15px;
            text-align: right;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            z-index: 100;
            box-sizing: border-box;
            backdrop-filter: blur(5px);
        }

        .page-title {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--text-color);
            margin: 0 0 5px 0;
        }

        .disclaimer {
            font-size: 0.75rem;
            color: gray;
            line-height: 1.3;
        }

        /* --- 3. ä¸»å…§å®¹å€ --- */
        .container {
            max-width: 800px;
            margin: 110px auto 0;
            padding: 20px;
        }

        .sentence-item {
            background: #fff;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            transition: transform 0.2s, background-color 0.3s;
        }

        .pinyin {
            font-family: 'StandardPinyin', sans-serif;
            font-size: 1.15rem;
            color: var(--pinyin-color);
            margin-bottom: 8px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .chinese-text {
            font-size: 1.4rem;
            color: var(--text-color);
            line-height: 1.6;
            margin-bottom: 15px;
            font-weight: 500;
            text-align: justify;
        }

        .controls {
            align-self: flex-end;
            width: 100%;
            text-align: right;
        }

        .play-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 25px;
            padding: 10px 24px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-family: inherit;
            box-shadow: 0 4px 6px rgba(74, 144, 226, 0.2);
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        .play-btn:active {
            transform: scale(0.96);
        }

        .play-btn.playing {
            background: #ff6b6b;
            box-shadow: 0 4px 6px rgba(255, 107, 107, 0.2);
        }

        /* --- 4. åº•éƒ¨çå‹µæ¬„ --- */
        .reward-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            height: 90px;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.08);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 200;
            padding: 0 5%;
            box-sizing: border-box;
        }

        .track-container {
            width: 100%;
            max-width: 600px;
            position: relative;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .track-line {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 6px;
            background: #f0f0f0;
            z-index: 1;
            transform: translateY(-50%);
            border-radius: 3px;
        }

        .star-node {
            font-size: 24px;
            color: var(--star-inactive);
            z-index: 2;
            position: relative;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            line-height: 1;
            background: white;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .star-node.active {
            color: var(--star-active);
            transform: scale(1.3);
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }

        .trophy {
            font-size: 32px;
            color: var(--star-inactive);
            z-index: 2;
            position: relative;
            transition: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            margin-left: 10px;
            background: white;
        }

        .trophy.active {
            color: #f39c12;
            filter: drop-shadow(0 0 8px rgba(243, 156, 18, 0.6));
            transform: scale(1.4) rotate(-15deg);
        }

        /* --- 5. å®ŒæˆæŒ‰éˆ•å€åŸŸ --- */
        .completion-area {
            text-align: center;
            margin: 40px 0 20px;
            opacity: 0.3;
            pointer-events: none;
            filter: grayscale(1);
            transition: all 0.5s ease;
        }

        .completion-area.unlocked {
            opacity: 1;
            pointer-events: auto;
            filter: grayscale(0);
        }

        .finish-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 16px 40px;
            font-size: 1.2rem;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0, 242, 254, 0.3);
            font-weight: bold;
            font-family: inherit;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .finish-btn:active {
            transform: scale(0.98);
        }

        .home-link {
            margin-top: 25px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            color: #666;
            text-decoration: none;
            font-size: 1rem;
            padding: 10px 20px;
            border-radius: 20px;
            background: #f0f0f0;
            opacity: 1 !important; 
            pointer-events: auto !important;
            filter: grayscale(0) !important;
        }

        /* --- 6. ç™»éŒ„å½ˆçª— --- */
        #login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255,255,255,1);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .login-box {
            background: white;
            padding: 40px 30px;
            border-radius: 24px;
            text-align: center;
            width: 85%;
            max-width: 340px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
        }

        .login-input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #eee;
            border-radius: 12px;
            font-size: 1rem;
            box-sizing: border-box;
            font-family: inherit;
            outline: none;
            transition: border-color 0.3s;
            -webkit-appearance: none;
        }

        .login-input:focus {
            border-color: var(--primary-color);
        }

        /* --- 7. é–‹ç™¼è€…æ¨¡å¼ --- */
        #dev-trigger {
            position: fixed;
            top: 15px;
            left: 15px;
            font-size: 24px;
            color: #ccc;
            cursor: pointer;
            z-index: 2000;
            display: none; /* é»˜èªéš±è— */
            opacity: 0.3;
        }
        
        #dev-trigger:hover { opacity: 1; }
        
        #dev-panel {
            position: fixed;
            bottom: 120px;
            left: 20px;
            background: rgba(20,20,20,0.95);
            color: #0f0;
            padding: 20px;
            border-radius: 12px;
            z-index: 3000;
            display: none;
            width: 320px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            font-family: monospace;
            border: 1px solid #333;
        }

        #dev-panel button {
            margin: 5px 2px;
            padding: 8px 12px;
            cursor: pointer;
            background: #444;
            color: white;
            border: 1px solid #666;
            border-radius: 4px;
        }

        /* --- 8. æˆåŠŸå½ˆçª— --- */
        .custom-alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: white;
            padding: 30px;
            border-radius: 24px;
            box-shadow: 0 20px 80px rgba(0,0,0,0.3);
            z-index: 4000;
            text-align: center;
            display: none;
            width: 80%;
            max-width: 300px;
            opacity: 0;
            transition: all 0.3s;
        }
        
        .custom-alert.show {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }
        
        .custom-alert h3 { margin-top: 0; color: var(--primary-color); font-size: 1.5rem; }
        
        .close-alert {
            margin-top: 20px;
            background: #f0f0f0;
            border: none;
            padding: 12px 40px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            color: #555;
            font-weight: bold;
        }

        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 3999;
            display: none;
            backdrop-filter: blur(2px);
        }

    </style>
</head>
<body>

    <!-- ç™»éŒ„å±¤ -->
    <div id="login-overlay">
        <div class="login-box">
            <h2 style="color: var(--primary-color); margin-bottom: 20px;">é–‹å§‹ç·´ç¿’</h2>
            <form id="login-form" onsubmit="event.preventDefault(); attemptLogin();">
                <input type="text" id="username" class="login-input" placeholder="è«‹è¼¸å…¥æ‚¨çš„åå­—" autocomplete="off" required>
                <input type="password" id="password" class="login-input" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" required>
                <button type="submit" class="finish-btn" style="width:100%; margin-top:20px; font-size:1.1rem; padding: 12px;">é€²å…¥</button>
            </form>
            <p id="login-msg" style="color: #ff4757; font-size: 0.9rem; height: 1.5em; margin-top: 15px;"></p>
        </div>
    </div>

    <!-- é ‚éƒ¨æ¨™é¡Œ -->
    <header class="header">
        <div class="page-title">æ™®é€šè©±æ°´å¹³æ¸¬è©¦æœ—è®€ä½œå“5è™Ÿ</div>
        <div class="disclaimer">
            æœ¬ç¶²é æ‹¼éŸ³å‡ç”±AIç”Ÿæˆï¼Œæ¨™æº–æ³¨éŸ³è«‹åƒè€ƒã€Šæ™®é€šè©±æ°´å¹³æ¸¬è©¦å¯¦æ–½ç¶±è¦ï¼ˆ2021å¹´ç‰ˆï¼‰ã€‹ã€‚<br>
            éŒ„éŸ³åƒ…ä¾›åƒè€ƒã€‚ç¶²é åƒ…ä¾›VTCå†…éƒ¨ä½¿ç”¨ã€‚è·æ¥­è¨“ç·´å±€æ™®é€šè©±åŸ¹è¨“æ¸¬è©¦ä¸­å¿ƒç‰ˆæ¬Šæ‰€æœ‰ã€‚
        </div>
    </header>

    <!-- é–‹ç™¼è€…æŒ‰éˆ• (åƒ…Windowså¯è¦‹) -->
    <div id="dev-trigger" onclick="toggleDevMode()" title="é–‹ç™¼è€…æ¨¡å¼">ğŸ› ï¸</div>

    <!-- é–‹ç™¼è€…é¢æ¿ -->
    <div id="dev-panel">
        <h3 style="margin-top:0; border-bottom:1px solid #555; padding-bottom:10px; color:#fff;">æ™‚é–“è»¸éŒ„è£½å·¥å…·</h3>
        <p>ç‹€æ…‹: <span id="dev-status" style="color:#fff;">å°±ç·’</span></p>
        <p>æ™‚é–“: <span id="dev-time" style="font-size:1.5rem; color:#0ff;">0.00</span> s</p>
        <div style="display:flex; flex-wrap:wrap; gap:5px;">
            <button onclick="startRecording()" style="background:#2ecc71;">â–¶ é–‹å§‹éŒ„è£½</button>
            <button onclick="markNext()" style="background:#e67e22; flex-grow:1;">ğŸš© æ¨™è¨˜ä¸‹ä¸€å¥ (Space)</button>
            <button onclick="exportData()" style="background:#3498db;">ğŸ“‹ è¤‡è£½ JSON</button>
        </div>
        <div style="font-size: 0.75rem; margin-top:15px; color:#aaa; line-height:1.4;">
            æ­¥é©Ÿï¼š1.é»æ“Šé–‹å§‹ 2.æ¯è½åˆ°å¥æœ«ç«‹å³æŒ‰æ¨™è¨˜(æˆ–ç©ºæ ¼) 3.å…¨éƒ¨æ’­å®Œå¾Œè¤‡è£½ä»£ç¢¼ 4.æ›¿æ›æºæ–‡ä»¶ sentenceData
        </div>
    </div>

    <!-- ä¸»å…§å®¹ -->
    <div class="container" id="content-area"></div>

    <!-- å®Œæˆå€åŸŸ -->
    <div class="completion-area" id="completion-area">
        <button class="finish-btn" id="final-btn" onclick="finishPractice()">æˆ‘å·²å®Œæˆè·Ÿè®€ç·´ç¿’å•¦ï¼</button>
        <br>
        <a href="https://echo02-game.github.io/pscleadreading-hub/" class="home-link">
            <span>ğŸ“–</span> å›ä¸»ç›®éŒ„
        </a>
    </div>

    <!-- åº•éƒ¨çå‹µè»Œé“ -->
    <div class="reward-bar">
        <div class="track-container" id="track-container">
            <div class="track-line"></div>
        </div>
    </div>

    <!-- æˆåŠŸå½ˆçª— -->
    <div class="modal-backdrop" id="modal-backdrop"></div>
    <div class="custom-alert" id="success-alert">
        <div style="font-size: 3rem; margin-bottom: 10px;">ğŸ‰</div>
        <h3>å¤ªæ£’å•¦ï¼</h3>
        <p style="color:#666; line-height:1.5;">æ‰“å¡ä¿¡æ¯å·²è¤‡è£½ï¼Œå¿«å»åˆ†äº«åŠªåŠ›å¾Œçš„å–œæ‚…å§ï¼</p>
        <button class="close-alert" onclick="closeAlert()">é—œé–‰</button>
    </div>

    <!-- éŸ³é »æº -->
    <audio id="main-audio" src="pscleadreading05.mp4" preload="auto" playsinline></audio>

<script>
    // --- æ ¸å¿ƒæ•¸æ“š (ä½œå“5è™Ÿ) ---
    // æç¤ºï¼šå› ç‚ºæ˜¯æ–°éŸ³é »ï¼Œæ‰€æœ‰ start/end åˆå§‹è¨­ç‚º0ã€‚
    // è«‹åœ¨Windowsé›»è…¦ä¸Šé»æ“Šå·¦ä¸Šè§’ç°è‰²ğŸ› ï¸é€²å…¥é–‹ç™¼è€…æ¨¡å¼ï¼Œè‡ªè¡Œæ’­æ”¾ä¸¦æ¨™è¨˜æ™‚é–“è»¸ã€‚
    let sentenceData = [
    {
        "text": "å»éæ•…å®®å¤§ä¿®ç¾å ´çš„äººï¼Œå°±æœƒç™¼ç¾é€™è£å’Œå¤–é¢å·¥åœ°çš„å‹ä½œæ™¯è±¡æœ‰å€‹æ˜é¡¯çš„å€åˆ¥ï¼šé€™è£æ²’æœ‰èµ·é‡æ©Ÿï¼Œå»ºç¯‰ææ–™éƒ½æ˜¯ä»¥æ‰‹æ¨è»Šçš„å½¢å¼é€å¾€å·¥åœ°ï¼Œé‡åˆ°äººåŠ›ç„¡æ³•é‹é€çš„æœ¨æ–™æ™‚ï¼Œå·¥äººå€‘æœƒä½¿ç”¨ç™¾å¹´ä¸è®Šçš„å·¥å…·â€”â€”æ»‘è¼ªçµ„ã€‚",
        "pinyin": "QÃ¹guÃ² GÃ¹gÅng dÃ xiÅ« xiÃ nchÇng de rÃ©n, jiÃ¹huÃ¬ fÄxiÃ n zhÃ¨lÇ hÃ© wÃ imiÃ n gÅngdÃ¬ de lÃ¡ozuÃ² jÇngxiÃ ng yÇ’u gÃ¨ mÃ­ngxiÇn de qÅ«biÃ©: ZhÃ¨lÇ mÃ©iyÇ’u qÇzhÃ²ngjÄ«, jiÃ nzhÃ¹ cÃ¡iliÃ o dÅu shÃ¬ yÇ shÇ’utuÄ«chÄ“ de xÃ­ngshÃ¬ sÃ²ngwÇng gÅngdÃ¬, yÃ¹dÃ o rÃ©nlÃ¬ wÃºfÇ yÃ¹nsÃ²ng de mÃ¹liÃ o shÃ­, gÅngrÃ©nmen huÃ¬ shÇyÃ²ng bÇiniÃ¡n bÃ¹biÃ n de gÅngjÃ¹â€”â€”huÃ¡lÃºnzÇ”.",
        "start": 0,
        "end": 32.68
    },
    {
        "text": "æ•…å®®ä¿®ç¹•ï¼Œå°Šé‡ç€â€œå››åŸâ€åŸå‰‡ï¼Œå³åŸææ–™ã€åŸå·¥è—ã€åŸçµæ§‹ã€åŸå‹åˆ¶ã€‚",
        "pinyin": "GÃ¹gÅng xiÅ«shÃ n, zÅ«nzhÃ²ng zhe â€œsÃ¬yuÃ¡nâ€ yuÃ¡nzÃ©, jÃ­ yuÃ¡ncÃ¡iliÃ o, yuÃ¡n gÅngyÃ¬, yuÃ¡n jiÃ©gÃ²u, yuÃ¡n xÃ­ngzhÃ¬.",
        "start": 32.68,
        "end": 44.59
    },
    {
        "text": "åœ¨ä¸å½±éŸ¿é«”ç¾å‚³çµ±å·¥è—æŠ€è¡“æ‰‹æ³•ç‰¹é»çš„åœ°æ–¹ï¼Œå·¥åŒ å¯ä»¥ç”¨é›»å‹•å·¥å…·ï¼Œæ¯”å¦‚é–‹è’æ–™ã€æˆªé ­ã€‚",
        "pinyin": "ZÃ i bÃ¹ yÇngxiÇng tÇxiÃ n chuÃ¡ntÇ’ng gÅngyÃ¬ jÃ¬shÃ¹ shÇ’ufÇ tÃ¨diÇn de dÃ¬fÄng, gÅngjiÃ ng kÄ›yÇ yÃ²ng diÃ ndÃ²ng gÅngjÃ¹, bÇrÃº kÄihuÄngliÃ o, jiÃ©tÃ³u.",
        "start": 44.59,
        "end": 59.21
    },
    {
        "text": "å¤§å¤šæ•¸æ™‚å€™å·¥åŒ éƒ½ç”¨å‚³çµ±å·¥å…·ï¼šæœ¨åŒ ç•«ç·šç”¨çš„æ˜¯å¢¨æ–—ã€ç•«ç±¤ã€æ¯›ç­†ã€æ–¹å°ºã€æ–ç«¿ã€äº”å°ºï¼›åŠ å·¥è£½ä½œæœ¨æ§‹ä»¶ä½¿ç”¨çš„å·¥å…·æœ‰éŒ›ã€é‘¿ã€æ–§ã€é‹¸ã€åˆ¨ç­‰ç­‰ã€‚",
        "pinyin": "DÃ duÅshÃ¹ shÃ­hÃ²u gÅngjiÃ ng dÅu yÃ²ng chuÃ¡ntÇ’ng gÅngjÃ¹: MÃ¹jiÃ ng huÃ xiÃ n yÃ²ng de shÃ¬ mÃ²dÇ’u, huÃ qiÄn, mÃ¡obÇ, fÄngchÇ, zhÃ nggÄn, wÇ”chÇ; jiÄgÅng zhÃ¬zuÃ² mÃ¹gÃ²ujiÃ n shÇyÃ²ng de gÅngjÃ¹ yÇ’u bÄ“n, zÃ¡o, fÇ”, jÃ¹, pÃ¡o dÄ›ngdÄ›ng.",
        "start": 59.21,
        "end": 85.93
    },
    {
        "text": "æœ€èƒ½é«”ç¾å¤§ä¿®é›£åº¦çš„ä¾¿æ˜¯ç“¦ä½œä¸­â€œè‹«èƒŒâ€çš„ç’°ç¯€ã€‚",
        "pinyin": "ZuÃ¬ nÃ©ng tÇxiÃ n dÃ xiÅ« nÃ¡ndÃ¹ de biÃ n shÃ¬ wÇzuÃ² zhÅng â€œshÄnbÃ¨iâ€ de huÃ¡njiÃ©.",
        "start": 85.93,
        "end": 95.51
    },
    {
        "text": "â€œè‹«èƒŒâ€æ˜¯æŒ‡åœ¨æˆ¿é ‚åšç°èƒŒçš„éç¨‹ï¼Œå®ƒç›¸ç•¶æ–¼ç‚ºæœ¨å»ºç¯‰æ·»ä¸Šé˜²æ°´å±¤ã€‚",
        "pinyin": "â€œShÄnbÃ¨iâ€ shÃ¬ zhÇ zÃ i fÃ¡ngdÇng zuÃ² huÄ«bÃ¨i de guÃ²chÃ©ng, tÄ xiÄngdÄngyÃº wÃ¨i mÃ¹jiÃ nzhÃ¹ tiÄnshÃ ng fÃ¡ngshuÇcÃ©ng.",
        "start": 95.51,
        "end": 106.13
    },
    {
        "text": "æœ‰å¥å£è¨£æ˜¯ä¸‰æ¼¿ä¸‰å£“ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸‰éçŸ³ç°æ¼¿ï¼Œç„¶å¾Œå†å£“ä¸Šä¸‰éã€‚",
        "pinyin": "YÇ’u jÃ¹ kÇ’ujuÃ© shÃ¬ sÄnjiÄng sÄnyÄ, yÄ› jiÃ¹shÃ¬ shÃ ng sÄnbiÃ n shÃ­huÄ«jiÄng, rÃ¡nhÃ²u zÃ i yÄ shÃ ng sÄnbiÃ n.",
        "start": 106.13,
        "end": 117.67
    },
    {
        "text": "ä½†é€™æ˜¯å€‹è™›æ•¸ã€‚",
        "pinyin": "DÃ n zhÃ¨ shÃ¬ gÃ¨ xÅ«shÃ¹.",
        "start": 117.67,
        "end": 121.21
    },
    {
        "text": "ä»Šå¤©æ˜¯æ™´å¤©ï¼Œä¹¾å¾—å¿«ï¼Œä¸‰æ¼¿ä¸‰å£“ç¡¬åº¦å°±èƒ½ç¬¦åˆè¦æ±‚ï¼Œè¦æ˜¯è¶•ä¸Šé™°å¤©ï¼Œèªªä¸å®šå°±è¦å…­æ¼¿å…­å£“ã€‚",
        "pinyin": "JÄ«ntiÄn shÃ¬ qÃ­ngtiÄn, gÄn de kuÃ i, sÄnjiÄng sÄnyÄ yÃ¬ngdÃ¹ jiÃ¹nÃ©ng fÃºhÃ© yÄoqiÃº, yÃ oshi gÇnshÃ ng yÄ«ntiÄn, shuÅbudÃ¬ng jiÃ¹yÃ o liÃ¹jiÄng liÃ¹yÄ.",
        "start": 121.21,
        "end": 138.03
    },
    {
        "text": "ä»»ä½•ä¸€å€‹ç’°ç¯€çš„ç–æ¼éƒ½å¯èƒ½å°è‡´æ¼é›¨ï¼Œè€Œé€™å°å»ºç¯‰çš„æå£æ˜¯è‡´å‘½çš„ã€‚",
        "pinyin": "RÃ¨nhÃ© yÄ«gÃ¨ huÃ¡njiÃ© de shÅ«lÃ²u dÅu kÄ›nÃ©ng dÇozhÃ¬ lÃ²uyÇ”, Ã©r zhÃ¨ duÃ¬ jiÃ nzhÃ¹ de sÇ”nhuÃ i shÃ¬ zhÃ¬mÃ¬ng de.",
        "start": 138.03,
        "end": 149.45
    },
    {
        "text": "â€œå·¥â€å­—æ—©åœ¨æ®·å¢Ÿç”²éª¨åœè¾­ä¸­å°±å·²ç¶“å‡ºç¾éã€‚",
        "pinyin": "â€œGÅngâ€ zÃ¬ zÇo zÃ i YÄ«nxÅ« JiÇgÇ” bÇ”cÃ­ zhÅng jiÃ¹ yÇjÄ«ng chÅ«xiÃ n guÃ².",
        "start": 149.45,
        "end": 158.71
    },
    {
        "text": "ã€Šå‘¨å®˜ã€‹èˆ‡ã€Šæ˜¥ç§‹å·¦å‚³ã€‹è¨˜è¼‰å‘¨ç‹æœèˆ‡è«¸ä¾¯éƒ½è¨­æœ‰æŒç®¡ç‡Ÿé€ çš„æ©Ÿæ§‹ã€‚",
        "pinyin": "ã€ŠZhÅuguÄnã€‹ yÇ” ã€ŠChÅ«nqiÅ« ZuÇ’zhuÃ nã€‹ jÃ¬zÇi ZhÅu wÃ¡ngchÃ¡o yÇ” zhÅ«hÃ³u dÅu shÃ¨yÇ’u zhÇngguÇn yÃ­ngzÃ o de jÄ«gÃ²u.",
        "start": 158.71,
        "end": 170.66
    },
    {
        "text": "ç„¡æ•¸çš„åå·¥å·§åŒ ç‚ºæˆ‘å€‘ç•™ä¸‹äº†é‚£éº¼å¤šå®å‰çš„å»ºç¯‰ï¼Œä½†å»//å¾ˆå°‘è¢«åˆ—å…¥å²ç±ï¼Œæšåæ–¼å¾Œä¸–ã€‚",
        "pinyin": "WÃºshÃ¹ de mÃ­nggÅng qiÇojiÃ ng wÃ¨i wÇ’men liÃºxiÃ  le nÃ me duÅ hÃ³ngwÄ›i de jiÃ nzhÃ¹, dÃ n quÃ¨ // hÄ›nshÇo bÃ¨i liÃ¨rÃ¹ shÇjÃ­, yÃ¡ngmÃ­ng yÃº hÃ²ushÃ¬.",
        "start": 170.66,
        "end": 184.34
    }
];

    // --- å…¨å±€è®Šé‡ ---
    let currentUser = "";
    let audio = document.getElementById('main-audio');
    let currentSentenceIndex = -1;
    let isPlaying = false;
    let completedSentences = new Array(sentenceData.length).fill(false);
    let checkTimer = null;

    // --- 1. ç™»éŒ„èˆ‡åˆå§‹åŒ– ---
    function attemptLogin() {
        const nameInput = document.getElementById('username');
        const passInput = document.getElementById('password');
        const msg = document.getElementById('login-msg');

        const nameVal = nameInput.value.trim();
        const passVal = passInput.value.trim();

        if (!nameVal) {
            msg.textContent = "è«‹è¼¸å…¥åå­—";
            nameInput.focus();
            return;
        }

        if (passVal === 'vtcpsc') {
            currentUser = nameVal;
            document.getElementById('login-overlay').style.display = 'none';
            // iOSéœ€ç”¨æˆ¶äº¤äº’è§¸ç™¼åŠ è¼‰
            audio.load();
            initApp();
        } else {
            msg.textContent = "è«‹è¼¸å…¥æ­£ç¢ºå¯†ç¢¼";
            passInput.value = '';
            passInput.focus();
            passInput.style.borderColor = "#ff4757";
            setTimeout(() => passInput.style.borderColor = "#eee", 500);
        }
    }

    function initApp() {
        const container = document.getElementById('content-area');
        const track = document.getElementById('track-container');

        sentenceData.forEach((item, index) => {
            // å‰µå»ºå¥å­å€å¡Š
            const div = document.createElement('div');
            div.className = 'sentence-item';
            div.id = `sent-${index}`;
            div.innerHTML = `
                <div class="pinyin">${item.pinyin}</div>
                <div class="chinese-text">${item.text}</div>
                <div class="controls">
                    <button class="play-btn" id="btn-${index}" onclick="toggleSentence(${index})">
                        <span>â–¶</span> æ’­æ”¾
                    </button>
                </div>
            `;
            container.appendChild(div);

            // å‰µå»ºé€²åº¦æ˜Ÿæ˜Ÿ
            const star = document.createElement('div');
            star.className = 'star-node';
            star.id = `star-${index}`;
            star.innerText = 'â˜…';
            track.appendChild(star);
        });

        // æ·»åŠ çµ‚é»çæ¯
        const trophy = document.createElement('div');
        trophy.className = 'trophy';
        trophy.id = 'trophy';
        trophy.innerHTML = 'ğŸ†';
        track.appendChild(trophy);

        // Windowsç’°å¢ƒé¡¯ç¤ºé–‹ç™¼è€…æŒ‰éˆ•
        if (navigator.userAgent.indexOf("Windows") !== -1) {
            document.getElementById('dev-trigger').style.display = 'block';
        }
    }

    // --- 2. æ’­æ”¾é‚è¼¯ ---
    let sentenceEndState = false;

    function toggleSentence(index) {
        const data = sentenceData[index];
        const btn = document.getElementById(`btn-${index}`);

        // åˆ‡æ›åˆ°æ–°å¥å­
        if (currentSentenceIndex !== index) {
            if (currentSentenceIndex !== -1) {
                resetBtnUI(currentSentenceIndex); // é‡ç½®ä¸Šä¸€å€‹
            }
            currentSentenceIndex = index;
            sentenceEndState = false;
            startPlayback(index, data.start);
        } 
        // æ“ä½œç•¶å‰å¥å­
        else {
            if (sentenceEndState) {
                // å·²çµæŸ -> é‡æ–°é–‹å§‹
                sentenceEndState = false;
                startPlayback(index, data.start);
            } else if (isPlaying) {
                // æ’­æ”¾ä¸­ -> æš«åœ
                audio.pause();
                isPlaying = false;
                updateBtnUI(index, false);
                stopTimer();
            } else {
                // æš«åœä¸­ -> ç¹¼çºŒ
                audio.play().catch(e => console.error("Play error:", e));
                isPlaying = true;
                updateBtnUI(index, true);
                startTimer(index);
            }
        }
    }

    function startPlayback(index, startTime) {
        // å¦‚æœæ•¸æ“šç‚ºç©ºä¸”æœªé–‹å•Ÿé–‹ç™¼è€…æ¨¡å¼ï¼Œçµ¦äºˆæç¤ºæˆ–é»˜èªæ’­æ”¾
        if (sentenceData[index].end === 0 && !devModeActive) {
            console.log("è­¦å‘Š: æ™‚é–“è»¸å°šæœªéŒ„è£½ï¼Œå°‡å¾é ­æ’­æ”¾");
        }

        audio.currentTime = startTime;
        const playPromise = audio.play();
        
        if (playPromise !== undefined) {
            playPromise.then(() => {
                isPlaying = true;
                updateBtnUI(index, true);
                startTimer(index);
            }).catch(error => {
                console.error("Playback failed:", error);
                alert("æ’­æ”¾å¤±æ•—ï¼Œè«‹æª¢æŸ¥éŸ³é »æ–‡ä»¶æ˜¯å¦æ­£ç¢ºåŠ è¼‰ã€‚");
            });
        }
    }

    function startTimer(index) {
        if (checkTimer) clearInterval(checkTimer);
        checkTimer = setInterval(() => {
            const data = sentenceData[index];
            const now = audio.currentTime;

            // é–‹ç™¼è€…æ¨¡å¼ï¼šæ›´æ–°é¢æ¿æ™‚é–“
            if (devModeActive) {
                document.getElementById('dev-time').innerText = now.toFixed(2);
            } else {
                // æ™®é€šæ¨¡å¼ï¼šæª¢æŸ¥çµæŸæ™‚é–“
                // å¦‚æœ end ç‚º 0ï¼Œèªªæ˜æœªéŒ„è£½ï¼Œæš«ä¸è‡ªå‹•åœæ­¢
                if (data.end > 0 && now >= data.end) {
                    audio.pause();
                    isPlaying = false;
                    sentenceEndState = true;
                    stopTimer();
                    updateBtnUI(index, false); 
                    markCompleted(index);
                }
            }
        }, 30);
    }

    function stopTimer() {
        if (checkTimer) clearInterval(checkTimer);
        checkTimer = null;
    }

    function updateBtnUI(index, isPlaying) {
        const btn = document.getElementById(`btn-${index}`);
        if (!btn) return;
        
        if (isPlaying) {
            btn.classList.add('playing');
            btn.innerHTML = '<span>âšâš</span> æš«åœ';
        } else {
            btn.classList.remove('playing');
            btn.innerHTML = '<span>â–¶</span> æ’­æ”¾';
        }
    }

    function resetBtnUI(index) {
        updateBtnUI(index, false);
        audio.pause();
    }

    // --- 3. çå‹µç³»çµ± ---
    function markCompleted(index) {
        if (!completedSentences[index]) {
            completedSentences[index] = true;
            document.getElementById(`star-${index}`).classList.add('active');
            
            // æª¢æŸ¥å…¨äº®
            if (completedSentences.every(Boolean)) {
                setTimeout(() => {
                    document.getElementById('trophy').classList.add('active');
                    document.getElementById('completion-area').classList.add('unlocked');
                    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
                }, 500);
            }
        }
    }

    // --- 4. å®Œæˆèˆ‡åˆ†äº« ---
    function finishPractice() {
        const today = new Date();
        const dateStr = `${today.getMonth() + 1}æœˆ${today.getDate()}æ—¥`;
        const text = `${currentUser}å·²æ–¼${dateStr}å®Œæˆä½œå“5è™Ÿè·Ÿè®€ç·´ç¿’ï¼`;

        // å‰ªè²¼æ¿API
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(text).then(showSuccess).catch(() => legacyCopy(text));
        } else {
            legacyCopy(text);
        }
    }

    function legacyCopy(val) {
        const ta = document.createElement('textarea');
        ta.value = val;
        ta.style.position = 'fixed';
        ta.style.opacity = 0;
        document.body.appendChild(ta);
        ta.focus();
        ta.select();
        try {
            document.execCommand('copy');
            showSuccess();
        } catch (err) {
            alert("ç€è¦½å™¨ä¸æ”¯æŒè‡ªå‹•è¤‡è£½ï¼Œè«‹æ‰‹å‹•æˆªåœ–åˆ†äº«");
        }
        document.body.removeChild(ta);
    }

    function showSuccess() {
        document.getElementById('modal-backdrop').style.display = 'block';
        const alertBox = document.getElementById('success-alert');
        alertBox.style.display = 'block';
        setTimeout(() => alertBox.classList.add('show'), 10);
    }

    function closeAlert() {
        const alertBox = document.getElementById('success-alert');
        alertBox.classList.remove('show');
        setTimeout(() => {
            alertBox.style.display = 'none';
            document.getElementById('modal-backdrop').style.display = 'none';
        }, 300);
    }

    // --- 5. é–‹ç™¼è€…æ¨¡å¼ (Dev Mode) ---
    let devModeActive = false;
    let devSentences = [];
    let devCurrentIndex = 0;

    function toggleDevMode() {
        devModeActive = !devModeActive;
        const panel = document.getElementById('dev-panel');
        panel.style.display = devModeActive ? 'block' : 'none';
        
        if (devModeActive) {
            // å¼·åˆ¶é¡¯ç¤ºåŸç”Ÿæ’­æ”¾å™¨ä»¥ä¾¿èª¿è©¦æ‹–å‹•
            audio.controls = true; 
            audio.style.position = "fixed";
            audio.style.bottom = "200px";
            audio.style.left = "20px";
            audio.style.width = "calc(100% - 40px)";
            audio.style.zIndex = "2500";
            audio.style.display = "block";
            audio.style.background = "#f1f3f4";
            audio.style.borderRadius = "30px";
            document.getElementById('dev-status').innerText = "å·²é–‹å•Ÿã€‚è«‹é»æ“Šé–‹å§‹éŒ„è£½ã€‚";
        } else {
            audio.controls = false;
            audio.style.display = "none";
        }
    }

    function startRecording() {
        devSentences = [];
        devCurrentIndex = 0;
        audio.currentTime = 0;
        
        audio.play().then(() => {
            document.getElementById('dev-status').innerText = "éŒ„è£½ä¸­... ç­‰å¾…æ¨™è¨˜ç¬¬ 1 å¥";
            document.addEventListener('keydown', handleSpaceKey);
            if (!checkTimer) startTimer(0);
        });
    }

    function handleSpaceKey(e) {
        if (e.code === 'Space') {
            e.preventDefault();
            markNext();
        }
    }

    function markNext() {
        if (!devModeActive || devCurrentIndex >= sentenceData.length) return;
        
        const now = audio.currentTime;
        let start = 0;
        
        if (devSentences.length > 0) {
            start = devSentences[devSentences.length - 1].end;
        }

        const original = sentenceData[devCurrentIndex];
        
        devSentences.push({
            text: original.text,
            pinyin: original.pinyin,
            start: parseFloat(start.toFixed(2)),
            end: parseFloat(now.toFixed(2))
        });

        devCurrentIndex++;
        
        // UI æ›´æ–°
        if (devCurrentIndex < sentenceData.length) {
            document.getElementById('dev-status').innerText = `å·²æ¨™è¨˜ ${devCurrentIndex} å¥ã€‚æ­£åœ¨è½ç¬¬ ${devCurrentIndex + 1}...`;
            // é«˜äº®ç•¶å‰è¡Œ
            document.querySelectorAll('.sentence-item').forEach(el => el.style.background = '#fff');
            const currEl = document.getElementById(`sent-${devCurrentIndex}`);
            if(currEl) {
                currEl.style.background = '#e1f5fe';
                currEl.scrollIntoView({behavior: "smooth", block: "center"});
            }
        } else {
            document.getElementById('dev-status').innerText = "âœ… å®Œæˆï¼è«‹é»æ“Š [è¤‡è£½ JSON]";
            audio.pause();
            document.removeEventListener('keydown', handleSpaceKey);
        }
    }

    function exportData() {
        if (devSentences.length === 0) {
            alert("å°šæœªéŒ„è£½æ•¸æ“šï¼");
            return;
        }
        const json = JSON.stringify(devSentences, null, 4);
        navigator.clipboard.writeText(json).then(() => {
            alert("JSON å·²è¤‡è£½ï¼è«‹æ‰“é–‹æºç¢¼æ–‡ä»¶ï¼Œæ›¿æ›åŸæœ‰çš„ sentenceData è®Šé‡ã€‚");
        });
    }
</script>
</body>
</html>
