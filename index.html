<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ™®é€šè©±æ°´å¹³æ¸¬è©¦æœ—è®€ä½œå“5è™Ÿ</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --accent-color: #f5a623;
            --text-color: #333;
            --bg-color: #f9f9f9;
            --gray-text: #888;
        }

        body {
            font-family: "Yuanti SC", "YouYuan", "ZwKaiti", "KaiTi", "STKaiti", "BiauKai", sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
        }

        /* æ¨™é¡Œå›ºå®šå³ä¸Šè§’ */
        .fixed-header {
            position: fixed;
            top: 0;
            right: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px 15px;
            text-align: right;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            z-index: 1000;
            box-sizing: border-box;
        }

        .main-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #000;
            margin: 0;
        }

        .sub-title {
            font-size: 0.7rem;
            color: var(--gray-text);
            margin-top: 5px;
            line-height: 1.2;
        }

        /* ç™»éŒ„ç•Œé¢ */
        #login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .login-box {
            width: 100%;
            max-width: 320px;
            text-align: center;
        }

        .login-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 16px;
            font-family: inherit;
            box-sizing: border-box;
        }

        .login-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 20px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
            font-family: inherit;
        }

        /* ä¸»å…§å®¹ */
        #main-content {
            display: none;
            max-width: 800px;
            margin: 120px auto 100px; /* ç•™å‡º header å’Œ footer ç©ºé–“ */
            padding: 0 15px;
        }

        .sentence-container {
            background: white;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }

        .sentence-container.active {
            border: 2px solid var(--primary-color);
            transform: scale(1.01);
        }

        .pinyin {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 5px;
            word-spacing: 2px;
        }

        .hanzi {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .controls {
            display: flex;
            gap: 10px;
        }

        .ctrl-btn {
            background: #f0f0f0;
            border: none;
            padding: 8px 15px;
            border-radius: 15px;
            cursor: pointer;
            font-family: inherit;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }

        .ctrl-btn.play { color: var(--primary-color); }
        .ctrl-btn.pause { color: #e74c3c; display: none; }

        /* çå‹µå€åŸŸ */
        #reward-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: white;
            padding: 10px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 900;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            gap: 5px;
        }

        .star {
            color: #ccc;
            font-size: 1.2rem;
            transition: color 0.3s;
        }

        .star.earned {
            color: var(--accent-color);
        }

        .trophy {
            font-size: 1.5rem;
            opacity: 0.3;
            filter: grayscale(1);
            transition: all 0.5s;
        }

        .trophy.earned {
            opacity: 1;
            filter: grayscale(0);
            transform: scale(1.2);
        }

        /* åº•éƒ¨åŠŸèƒ½å€ */
        .bottom-actions {
            margin-top: 30px;
            text-align: center;
            padding-bottom: 80px;
        }

        .finish-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 1.1rem;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(245, 166, 35, 0.4);
            font-family: inherit;
            display: inline-block;
        }

        .back-link {
            position: fixed;
            bottom: 80px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            padding: 8px 15px;
            border-radius: 20px;
            text-decoration: none;
            color: #333;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            z-index: 899;
        }

        /* å½ˆçª— */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 3000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 80%;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        /* é–‹ç™¼è€…æ¨¡å¼æ¨£å¼ */
        #dev-toggle {
            position: fixed;
            bottom: 80px;
            left: 20px;
            font-size: 24px;
            cursor: pointer;
            z-index: 9999;
            opacity: 0.5;
        }

        #dev-panel {
            display: none;
            position: fixed;
            top: 50px;
            left: 10px;
            right: 10px;
            background: rgba(0,0,0,0.9);
            color: #0f0;
            padding: 15px;
            border-radius: 10px;
            z-index: 10000;
            font-family: monospace;
            max-height: 80vh;
            overflow-y: auto;
        }

        #dev-panel button {
            background: #333;
            color: white;
            border: 1px solid #555;
            padding: 5px 10px;
            margin: 5px;
            cursor: pointer;
        }

        #dev-console {
            background: #111;
            padding: 10px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-size: 12px;
            border: 1px solid #333;
            user-select: all;
        }
    </style>
</head>
<body>

    <!-- æ¨™é¡Œæ¬„ -->
    <div class="fixed-header">
        <div class="main-title">æ™®é€šè©±æ°´å¹³æ¸¬è©¦æœ—è®€ä½œå“5è™Ÿ</div>
        <div class="sub-title">
            æœ¬ç¶²é æ‹¼éŸ³å‡ç”±AIç”Ÿæˆï¼Œæ¨™æº–æ³¨éŸ³è«‹åƒè€ƒã€Šæ™®é€šè©±æ°´å¹³æ¸¬è©¦å¯¦æ–½ç¶±è¦ï¼ˆ2021å¹´ç‰ˆï¼‰ã€‹ã€‚<br>
            éŒ„éŸ³åƒ…ä¾›åƒè€ƒã€‚ç¶²é åƒ…ä¾›VTCå†…éƒ¨ä½¿ç”¨ã€‚è·æ¥­è¨“ç·´å±€æ™®é€šè©±åŸ¹è¨“æ¸¬è©¦ä¸­å¿ƒç‰ˆæ¬Šæ‰€æœ‰ã€‚
        </div>
    </div>

    <!-- ç™»éŒ„ç•Œé¢ -->
    <div id="login-screen">
        <div class="login-box">
            <h2 style="color: var(--primary-color);">è·Ÿè®€ç·´ç¿’ç™»å…¥</h2>
            <input type="text" id="username" class="login-input" placeholder="è«‹è¼¸å…¥æ‚¨çš„åå­—">
            <input type="password" id="password" class="login-input" placeholder="è«‹è¼¸å…¥å¯†ç¢¼">
            <button class="login-btn" onclick="checkLogin()">é€²å…¥</button>
            <p id="login-msg" style="color: red; font-size: 0.9rem;"></p>
        </div>
    </div>

    <!-- ä¸»å…§å®¹å€ -->
    <div id="main-content">
        <!-- å¥å­å°‡ç”± JS å‹•æ…‹ç”Ÿæˆ -->
        <div id="sentences-wrapper"></div>

        <div class="bottom-actions">
            <button class="finish-btn" onclick="finishExercise()">æˆ‘å·²å®Œæˆè·Ÿè®€ç·´ç¿’å•¦ï¼</button>
        </div>
    </div>

    <!-- åº•éƒ¨çå‹µæ¢ -->
    <div id="reward-bar">
        <div id="stars-container" style="display: flex; gap: 5px; flex-wrap: wrap; justify-content: center;"></div>
        <div class="trophy" id="trophy">ğŸ†</div>
    </div>

    <!-- è¿”å›é¦–é  -->
    <a href="https://echo02-game.github.io/pscleadreading-hub/" class="back-link">
        <span style="font-size: 1.2rem;">ğŸ“–</span> å†ç·´ä¸€ç¯‡
    </a>

    <!-- å½ˆçª— -->
    <div id="success-modal" class="modal" onclick="this.style.display='none'">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h2 style="color: var(--accent-color);">å¤ªæ£’å•¦ï¼ğŸ‰</h2>
            <p>æ‰“å¡ä¿¡æ¯å·²è¤‡è£½å¥½ï¼Œå¿«å»åˆ†äº«åŠªåŠ›å¾Œçš„å–œæ‚…å§ï¼</p>
            <p style="font-size: 0.8rem; color: #999;">(é»æ“Šä»»æ„è™•é—œé–‰)</p>
        </div>
    </div>

    <!-- éŸ³é »å…ƒç´  (éš±è—) -->
    <!-- æ³¨æ„ï¼šè«‹ç¢ºä¿æ–‡ä»¶åæ­£ç¢ºï¼Œä¸¦èˆ‡HTMLæ–‡ä»¶åœ¨åŒä¸€ç›®éŒ„ -->
    <audio id="main-audio" src="pscleadreading05.mp4" preload="auto"></audio>

    <!-- é–‹ç™¼è€…å·¥å…· -->
    <div id="dev-toggle" onclick="toggleDevPanel()">ğŸ› ï¸</div>
    <div id="dev-panel">
        <h3>æ™‚é–“è»¸æ¨™è¨˜å·¥å…·</h3>
        <div>ç•¶å‰æ’­æ”¾æ™‚é–“: <span id="dev-time">0.00</span>s</div>
        <div>ç•¶å‰æ¨™è¨˜å¥å­: <span id="dev-index">0</span> / <span id="dev-total">0</span></div>
        <div style="margin: 10px 0;">
            <button onclick="startDevRecording()">ğŸ”´ é–‹å§‹éŒ„è£½æ¨¡å¼</button>
            <button onclick="markNextSentence()">ğŸ“ æ¨™è¨˜ä¸‹ä¸€å¥ (Space)</button>
            <button onclick="exportJson()">ğŸ’¾ ç”Ÿæˆ JSON</button>
        </div>
        <div id="dev-current-text" style="color: #fff; margin: 5px 0; font-style: italic;"></div>
        <div id="dev-console">ç­‰å¾…éŒ„è£½...</div>
    </div>

    <script>
        // -------------------------
        // 1. æ•¸æ“šé…ç½® (æ ¸å¿ƒéƒ¨åˆ†)
        // -------------------------
        // é‡è¦ï¼šé€™è£çš„ start å’Œ end æ™‚é–“éœ€è¦é€šéé–‹ç™¼è€…æ¨¡å¼ç”Ÿæˆå¾Œæ›¿æ›ï¼
        // ç•¶å‰ç‚ºé ä¼°çš„åˆå§‹å€¼ï¼Œè«‹ä½¿ç”¨Devæ¨¡å¼æ ¡æº–ã€‚
        let sentenceData = [
    {
        "text": "ä½œå“5è™Ÿã€‚",
        "pinyin": "ZuÃ² pÇn wÇ” hÃ o.",
        "start": 0,
        "end": 5.03
    },
    {
        "text": "å»éæ•…å®®å¤§ä¿®ç¾å ´çš„äººï¼Œå°±æœƒç™¼ç¾é€™è£å’Œå¤–é¢å·¥åœ°çš„å‹ä½œæ™¯è±¡æœ‰å€‹æ˜é¡¯çš„å€åˆ¥ï¼š",
        "pinyin": "QÃ¹ guÃ² GÃ¹ gÅng dÃ  xiÅ« xiÃ n chÇng de rÃ©n, jiÃ¹ huÃ¬ fÄ xiÃ n zhÃ¨ lÇ hÃ© wÃ i miÃ n gÅng dÃ¬ de lÃ¡o zuÃ² jÇng xiÃ ng yÇ’u gÃ¨ mÃ­ng xiÇn de qÅ« biÃ©:",
        "start": 5.03,
        "end": 15.29
    },
    {
        "text": "é€™è£æ²’æœ‰èµ·é‡æ©Ÿï¼Œå»ºç¯‰ææ–™éƒ½æ˜¯ä»¥æ‰‹æ¨è»Šçš„å½¢å¼é€å¾€å·¥åœ°ï¼Œé‡åˆ°äººåŠ›ç„¡æ³•é‹é€çš„æœ¨æ–™æ™‚ï¼Œå·¥äººå€‘æœƒä½¿ç”¨ç™¾å¹´ä¸è®Šçš„å·¥å…·â€”â€”æ»‘è¼ªçµ„ã€‚",
        "pinyin": "ZhÃ¨ lÇ mÃ©i yÇ’u qÇ zhÃ²ng jÄ«, jiÃ n zhÃ¹ cÃ¡i liÃ o dÅu shÃ¬ yÇ shÇ’u tuÄ« chÄ“ de xÃ­ng shÃ¬ sÃ²ng wÇng gÅng dÃ¬, yÃ¹ dÃ o rÃ©n lÃ¬ wÃº fÇ yÃ¹n sÃ²ng de mÃ¹ liÃ o shÃ­, gÅng rÃ©n men huÃ¬ shÇ yÃ²ng bÇi niÃ¡n bÃº biÃ n de gÅng jÃ¹ â€”â€” huÃ¡ lÃºn zÇ”.",
        "start": 15.29,
        "end": 32.85
    },
    {
        "text": "æ•…å®®ä¿®ç¹•ï¼Œå°Šé‡ç€â€œå››åŸâ€åŸå‰‡ï¼Œå³åŸææ–™ã€åŸå·¥è—ã€åŸçµæ§‹ã€åŸå‹åˆ¶ã€‚",
        "pinyin": "GÃ¹ gÅng xiÅ« shÃ n, zÅ«n zhÃ²ng zhe â€œsÃ¬ yuÃ¡nâ€ yuÃ¡n zÃ©, jÃ­ yuÃ¡n cÃ¡i liÃ o, yuÃ¡n gÅng yÃ¬, yuÃ¡n jiÃ© gÃ²u, yuÃ¡n xÃ­ng zhÃ¬.",
        "start": 32.85,
        "end": 44.8
    },
    {
        "text": "åœ¨ä¸å½±éŸ¿é«”ç¾å‚³çµ±å·¥è—æŠ€è¡“æ‰‹æ³•ç‰¹é»çš„åœ°æ–¹ï¼Œå·¥åŒ å¯ä»¥ç”¨é›»å‹•å·¥å…·ï¼Œæ¯”å¦‚é–‹è’æ–™ã€æˆªé ­ã€‚",
        "pinyin": "ZÃ i bÃ¹ yÇng xiÇng tÇ xiÃ n chuÃ¡n tÇ’ng gÅng yÃ¬ jÃ¬ shÃ¹ shÇ’u fÇ tÃ¨ diÇn de dÃ¬ fang, gÅng jiÃ ng kÄ› yÇ yÃ²ng diÃ n dÃ²ng gÅng jÃ¹, bÇ rÃº kÄi huÄng liÃ o, jiÃ© tÃ³u.",
        "start": 44.8,
        "end": 59.33
    },
    {
        "text": "å¤§å¤šæ•¸æ™‚å€™å·¥åŒ éƒ½ç”¨å‚³çµ±å·¥å…·ï¼š",
        "pinyin": "DÃ  duÅ shÃ¹ shÃ­ hou gÅng jiÃ ng dÅu yÃ²ng chuÃ¡n tÇ’ng gÅng jÃ¹:",
        "start": 59.33,
        "end": 64.73
    },
    {
        "text": "æœ¨åŒ ç•«ç·šç”¨çš„æ˜¯å¢¨æ–—ã€ç•«ç±¤ã€æ¯›ç­†ã€æ–¹å°ºã€æ–ç«¿ã€äº”å°ºï¼›",
        "pinyin": "MÃ¹ jiÃ ng huÃ  xiÃ n yÃ²ng de shÃ¬ mÃ² dÇ’u, huÃ  qiÄn, mÃ¡o bÇ, fÄng chÇ, zhÃ ng gÄn, wÇ” chÇ;",
        "start": 64.73,
        "end": 74.41
    },
    {
        "text": "åŠ å·¥è£½ä½œæœ¨æ§‹ä»¶ä½¿ç”¨çš„å·¥å…·æœ‰éŒ›ã€é‘¿ã€æ–§ã€é‹¸ã€åˆ¨ç­‰ç­‰ã€‚",
        "pinyin": "JiÄ gÅng zhÃ¬ zuÃ² mÃ¹ gÃ²u jiÃ n shÇ yÃ²ng de gÅng jÃ¹ yÇ’u bÄ“n, zÃ¡o, fÇ”, jÃ¹, pÃ¡o dÄ›ng dÄ›ng.",
        "start": 74.41,
        "end": 86.18
    },
    {
        "text": "æœ€èƒ½é«”ç¾å¤§ä¿®é›£åº¦çš„ä¾¿æ˜¯ç“¦ä½œä¸­â€œè‹«èƒŒâ€çš„ç’°ç¯€ã€‚",
        "pinyin": "ZuÃ¬ nÃ©ng tÇ xiÃ n dÃ  xiÅ« nÃ¡n dÃ¹ de biÃ n shÃ¬ wÇ zuÃ² zhÅng â€œshÃ n bÃ¨iâ€ de huÃ¡n jiÃ©.",
        "start": 86.18,
        "end": 95.36
    },
    {
        "text": "â€œè‹«èƒŒâ€æ˜¯æŒ‡åœ¨æˆ¿é ‚åšç°èƒŒçš„éç¨‹ï¼Œå®ƒç›¸ç•¶æ–¼ç‚ºæœ¨å»ºç¯‰æ·»ä¸Šé˜²æ°´å±¤ã€‚",
        "pinyin": "â€œShÃ n bÃ¨iâ€ shÃ¬ zhÇ zÃ i fÃ¡ng dÇng zuÃ² huÄ« bÃ¨i de guÃ² chÃ©ng, tÄ xiÄng dÄng yÃº wÃ¨i mÃ¹ jiÃ n zhÃ¹ tiÄn shÃ ng fÃ¡ng shuÇ cÃ©ng.",
        "start": 95.36,
        "end": 105.98
    },
    {
        "text": "æœ‰å¥å£è¨£æ˜¯ä¸‰æ¼¿ä¸‰å£“ï¼Œä¹Ÿå°±æ˜¯ä¸Šä¸‰éçŸ³ç°æ¼¿ï¼Œç„¶å¾Œå†å£“ä¸Šä¸‰éã€‚",
        "pinyin": "YÇ’u jÃ¹ kÇ’u juÃ© shÃ¬ sÄn jiÄng sÄn yÄ, yÄ› jiÃ¹ shÃ¬ shÃ ng sÄn biÃ n shÃ­ huÄ« jiÄng, rÃ¡n hÃ²u zÃ i yÄ shÃ ng sÄn biÃ n.",
        "start": 105.98,
        "end": 117.58
    },
    {
        "text": "ä½†é€™æ˜¯å€‹è™›æ•¸ã€‚",
        "pinyin": "DÃ n zhÃ¨ shÃ¬ gÃ¨ xÅ« shÃ¹.",
        "start": 117.58,
        "end": 121.23
    },
    {
        "text": "ä»Šå¤©æ˜¯æ™´å¤©ï¼Œä¹¾å¾—å¿«ï¼Œä¸‰æ¼¿ä¸‰å£“ç¡¬åº¦å°±èƒ½ç¬¦åˆè¦æ±‚ï¼Œè¦æ˜¯è¶•ä¸Šé™°å¤©ï¼Œèªªä¸å®šå°±è¦å…­æ¼¿å…­å£“ã€‚",
        "pinyin": "JÄ«n tiÄn shÃ¬ qÃ­ng tiÄn, gÄn de kuÃ i, sÄn jiÄng sÄn yÄ yÃ¬ng dÃ¹ jiÃ¹ nÃ©ng fÃº hÃ© yÄo qiÃº, yÃ o shi gÇn shÃ ng yÄ«n tiÄn, shuÅ bu dÃ¬ng jiÃ¹ yÃ o liÃ¹ jiÄng liÃ¹ yÄ.",
        "start": 121.23,
        "end": 138.12
    },
    {
        "text": "ä»»ä½•ä¸€å€‹ç’°ç¯€çš„ç–æ¼éƒ½å¯èƒ½å°è‡´æ¼é›¨ï¼Œè€Œé€™å°å»ºç¯‰çš„æå£æ˜¯è‡´å‘½çš„ã€‚",
        "pinyin": "RÃ¨n hÃ© yÃ­ gÃ¨ huÃ¡n jiÃ© de shÅ« lÃ²u dÅu kÄ› nÃ©ng dÇo zhÃ¬ lÃ²u yÇ”, Ã©r zhÃ¨ duÃ¬ jiÃ n zhÃ¹ de sÇ”n huÃ i shÃ¬ zhÃ¬ mÃ¬ng de.",
        "start": 138.12,
        "end": 149.48
    },
    {
        "text": "â€œå·¥â€å­—æ—©åœ¨æ®·å¢Ÿç”²éª¨åœè¾­ä¸­å°±å·²ç¶“å‡ºç¾éã€‚",
        "pinyin": "â€œGÅngâ€ zÃ¬ zÇo zÃ i YÄ«n xÅ« jiÇ gÇ” bÇ” cÃ­ zhÅng jiÃ¹ yÇ jÄ«ng chÅ« xiÃ n guÃ².",
        "start": 149.48,
        "end": 158.73
    },
    {
        "text": "ã€Šå‘¨å®˜ã€‹èˆ‡ã€Šæ˜¥ç§‹å·¦å‚³ã€‹è¨˜è¼‰å‘¨ç‹æœèˆ‡è«¸ä¾¯éƒ½è¨­æœ‰æŒç®¡ç‡Ÿé€ çš„æ©Ÿæ§‹ã€‚",
        "pinyin": "ã€ŠZhÅu guÄnã€‹ yÇ” ã€ŠChÅ«n qiÅ« ZuÇ’ zhuÃ nã€‹ jÃ¬ zÇi ZhÅu wÃ¡ng chÃ¡o yÇ” zhÅ« hÃ³u dÅu shÃ¨ yÇ’u zhÇng guÇn yÃ­ng zÃ o de jÄ«gÃ²u.",
        "start": 158.73,
        "end": 170.73
    },
    {
        "text": "ç„¡æ•¸çš„åå·¥å·§åŒ ç‚ºæˆ‘å€‘ç•™ä¸‹äº†é‚£éº¼å¤šå®å‰çš„å»ºç¯‰ï¼Œä½†å»//å¾ˆå°‘è¢«åˆ—å…¥å²ç±ï¼Œæšåæ–¼å¾Œä¸–ã€‚",
        "pinyin": "WÃº shÃ¹ de mÃ­ng gÅng qiÇo jiÃ ng wÃ¨i wÇ’ men liÃº xiÃ  le nÃ  me duÅ hÃ³ng wÄ›i de jiÃ n zhÃ¹, dÃ n quÃ¨ // hÄ›n shÇo bÃ¨i liÃ¨ rÃ¹ shÇ jÃ­, yÃ¡ng mÃ­ng yÃº hÃ²u shÃ¬.",
        "start": 170.73,
        "end": 184.54
    }
]

        // -------------------------
        // 2. åˆå§‹åŒ–èˆ‡é‚è¼¯
        // -------------------------
        let currentUser = "";
        const audio = document.getElementById('main-audio');
        let playingIndex = -1;
        let playInterval;
        let progressStatus = new Array(sentenceData.length).fill(false);

        // ç™»éŒ„æª¢æŸ¥
        function checkLogin() {
            const user = document.getElementById('username').value.trim();
            const pass = document.getElementById('password').value.trim();
            const msg = document.getElementById('login-msg');

            if (pass === "vtcpsc" && user !== "") {
                currentUser = user;
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-content').style.display = 'block';
                initPage();
            } else {
                msg.textContent = "åå­—ä¸èƒ½ç‚ºç©ºï¼Œä¸”å¯†ç¢¼éœ€æ­£ç¢º (vtcpsc)";
                msg.style.animation = "shake 0.3s";
                setTimeout(() => msg.style.animation = "", 300);
            }
        }

        // ç¶å®šå›è»Šéµç™»éŒ„
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && document.getElementById('login-screen').style.display !== 'none') {
                checkLogin();
            }
        });

        // é é¢åˆå§‹åŒ–
        function initPage() {
            const wrapper = document.getElementById('sentences-wrapper');
            const starsContainer = document.getElementById('stars-container');

            sentenceData.forEach((item, index) => {
                // ç”Ÿæˆå¥å­å¡ç‰‡
                const div = document.createElement('div');
                div.className = 'sentence-container';
                div.id = `sent-${index}`;
                div.innerHTML = `
                    <div class="pinyin">${item.pinyin}</div>
                    <div class="hanzi">${item.text}</div>
                    <div class="controls">
                        <button class="ctrl-btn play" onclick="playSentence(${index})">
                            â–¶ æ’­æ”¾
                        </button>
                        <button class="ctrl-btn pause" id="pause-${index}" onclick="pauseAudio()">
                            â¸ æš«åœ
                        </button>
                    </div>
                `;
                wrapper.appendChild(div);

                // ç”Ÿæˆæ˜Ÿæ˜Ÿ
                const star = document.createElement('div');
                star.className = 'star';
                star.textContent = 'â˜…';
                star.id = `star-${index}`;
                starsContainer.appendChild(star);
            });
        }

        // æ’­æ”¾ç‰¹å®šå¥å­
        function playSentence(index) {
            // é‡ç½®ä¹‹å‰çš„ç‹€æ…‹
            if (playingIndex !== -1 && playingIndex !== index) {
                resetUI(playingIndex);
            }

            const range = sentenceData[index];
            
            // å¦‚æœæ˜¯æ–°å¥å­ï¼Œå¾é ­é–‹å§‹ï¼›å¦‚æœæ˜¯æš«åœå¾Œç¹¼çºŒï¼Œå¾ç•¶å‰æ™‚é–“é–‹å§‹
            if (playingIndex !== index) {
                audio.currentTime = range.start;
            }
            // ç¢ºä¿ä¸è¦è·³è½‰åˆ°ä¹‹å‰çš„å¥å­
            if (audio.currentTime < range.start || audio.currentTime > range.end) {
                audio.currentTime = range.start;
            }

            audio.play();
            playingIndex = index;
            updateUIState(index, true);

            // ç›£è½æ’­æ”¾é€²åº¦
            if (playInterval) clearInterval(playInterval);
            playInterval = setInterval(() => {
                if (audio.currentTime >= range.end) {
                    pauseAudio(true); // è‡ªç„¶çµæŸ
                }
            }, 50);
        }

        // æš«åœ
        function pauseAudio(finished = false) {
            audio.pause();
            clearInterval(playInterval);
            
            if (playingIndex !== -1) {
                updateUIState(playingIndex, false);
                if (finished) {
                    markFinished(playingIndex);
                    // æ’­æ”¾å®Œç•¢å¾Œé‡ç½®æ™‚é–“åˆ°æ®µè½é–‹é ­ï¼Œæ–¹ä¾¿é‡è½
                    audio.currentTime = sentenceData[playingIndex].start; 
                }
            }
        }

        function updateUIState(index, isPlaying) {
            const playBtn = document.querySelector(`#sent-${index} .play`);
            const pauseBtn = document.querySelector(`#sent-${index} .pause`);
            const container = document.getElementById(`sent-${index}`);

            if (isPlaying) {
                playBtn.style.display = 'none';
                pauseBtn.style.display = 'flex';
                container.classList.add('active');
            } else {
                playBtn.style.display = 'flex';
                pauseBtn.style.display = 'none';
                container.classList.remove('active');
            }
        }

        function resetUI(index) {
            updateUIState(index, false);
        }

        function markFinished(index) {
            if (!progressStatus[index]) {
                progressStatus[index] = true;
                const star = document.getElementById(`star-${index}`);
                star.classList.add('earned');
                
                // æª¢æŸ¥æ˜¯å¦å…¨éƒ¨å®Œæˆ
                if (progressStatus.every(s => s)) {
                    document.getElementById('trophy').classList.add('earned');
                }
            }
        }

        // å®ŒæˆæŒ‰éˆ•é‚è¼¯
        function finishExercise() {
            const date = new Date();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            const text = `${currentUser}å·²æ–¼${month}æœˆ${day}æ—¥å®Œæˆä½œå“5è™Ÿè·Ÿè®€ç·´ç¿’ï¼`;

            // è¤‡è£½åˆ°å‰ªè²¼æ¿
            navigator.clipboard.writeText(text).then(() => {
                document.getElementById('success-modal').style.display = 'flex';
            }).catch(err => {
                console.error('Copy failed', err);
                alert("å¤ªæ£’å•¦ï¼(è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•æˆªåœ–)");
            });
        }

        // -------------------------
        // 3. é–‹ç™¼è€…æ¨¡å¼ (Dev Mode)
        // -------------------------
        let isDevMode = false;
        let devRecordIndex = 0;
        let devTimestamps = [];
        let devStartTime = 0;

        function toggleDevPanel() {
            const panel = document.getElementById('dev-panel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        function startDevRecording() {
            if (!confirm("ç¢ºå®šè¦é–‹å§‹éŒ„è£½æ™‚é–“è»¸å—ï¼Ÿé€™å°‡é‡ç½®æ‰€æœ‰æ™‚é–“é»ã€‚è«‹åœ¨æ¯å¥çµæŸæ™‚æŒ‰ç©ºæ ¼ã€‚")) return;
            
            isDevMode = true;
            devRecordIndex = 0;
            devTimestamps = [];
            devStartTime = 0;
            
            // UI æ›´æ–°
            document.getElementById('dev-total').innerText = sentenceData.length;
            updateDevStatus();
            
            // é–‹å§‹æ’­æ”¾
            audio.currentTime = 0;
            audio.play();
            
            // éµç›¤ç›£è½
            document.addEventListener('keydown', devKeyHandler);
            
            // æ™‚é–“æ›´æ–°é¡¯ç¤º
            setInterval(() => {
                if(isDevMode) {
                    document.getElementById('dev-time').innerText = audio.currentTime.toFixed(2);
                }
            }, 100);
        }

        function devKeyHandler(e) {
            if (e.code === 'Space') {
                e.preventDefault(); // é˜²æ­¢æ»¾å‹•
                markNextSentence();
            }
        }

        function markNextSentence() {
            if (!isDevMode) return;
            
            const now = audio.currentTime;
            
            // è¨˜éŒ„ç•¶å‰å¥å­çš„æ™‚é–“æ®µ
            const sentence = sentenceData[devRecordIndex];
            const newRecord = {
                text: sentence.text,
                pinyin: sentence.pinyin,
                start: parseFloat(devStartTime.toFixed(2)),
                end: parseFloat(now.toFixed(2))
            };
            
            devTimestamps.push(newRecord);
            logDev(`å¥å­ ${devRecordIndex + 1} å®Œæˆ: ${newRecord.start}s -> ${newRecord.end}s`);
            
            // æº–å‚™ä¸‹ä¸€å¥
            devStartTime = now;
            devRecordIndex++;
            updateDevStatus();

            if (devRecordIndex >= sentenceData.length) {
                stopDevRecording();
            }
        }

        function updateDevStatus() {
            if (devRecordIndex < sentenceData.length) {
                document.getElementById('dev-index').innerText = devRecordIndex + 1;
                document.getElementById('dev-current-text').innerText = "æ­£åœ¨éŒ„è£½: " + sentenceData[devRecordIndex].text;
            } else {
                document.getElementById('dev-current-text').innerText = "éŒ„è£½å®Œæˆï¼è«‹é»æ“Šç”Ÿæˆ JSONã€‚";
            }
        }

        function stopDevRecording() {
            isDevMode = false;
            audio.pause();
            document.removeEventListener('keydown', devKeyHandler);
            alert("éŒ„è£½å®Œæˆï¼è«‹é»æ“Šã€Œç”Ÿæˆ JSONã€æŒ‰éˆ•ç²å–ä»£ç¢¼ã€‚");
        }

        function logDev(msg) {
            const consoleDiv = document.getElementById('dev-console');
            consoleDiv.innerText += msg + "\n";
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        function exportJson() {
            if (devTimestamps.length === 0) {
                alert("å°šæœªéŒ„è£½æ•¸æ“šï¼");
                return;
            }
            const jsonStr = JSON.stringify(devTimestamps, null, 4);
            const consoleDiv = document.getElementById('dev-console');
            consoleDiv.innerText = jsonStr;
            
            // è‡ªå‹•è¤‡è£½
            navigator.clipboard.writeText(jsonStr).then(() => {
                alert("JSON å·²è¤‡è£½åˆ°å‰ªè²¼æ¿ï¼è«‹å›åˆ°ä»£ç¢¼ä¸­æ›¿æ› sentenceData è®Šé‡ã€‚");
            });
        }
    </script>
</body>
</html>
